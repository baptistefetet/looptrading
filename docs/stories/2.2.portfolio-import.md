# Story 2.2: Import CSV du portfolio

## Status
Draft

## Story
**As a** user,
**I want** to import my portfolio from a CSV file,
**so that** I can quickly set up my positions without manual entry.

## Acceptance Criteria
1. Endpoint `POST /api/portfolio/import` accepte un fichier CSV
2. Format CSV supporté : symbol, quantity, avgCost, dateAcquired (optionnel)
3. Validation de chaque ligne avec rapport d'erreurs
4. Option "remplacer tout" ou "ajouter aux existantes"
5. Template CSV téléchargeable

## Tasks / Subtasks
- [ ] Créer endpoint import CSV (AC: 1)
  - [ ] Route `POST /api/portfolio/import`
  - [ ] Multipart form data pour upload fichier
  - [ ] Parser CSV avec validation
- [ ] Définir format CSV (AC: 2)
  - [ ] Colonnes : symbol, quantity, avgCost, dateAcquired
  - [ ] Séparateur : virgule ou point-virgule
  - [ ] Encoding UTF-8
- [ ] Implémenter validation (AC: 3)
  - [ ] Vérifier que symbol existe (Yahoo Finance)
  - [ ] Vérifier quantity > 0
  - [ ] Vérifier avgCost > 0
  - [ ] Rapport : lignes importées, lignes en erreur avec raison
- [ ] Option de mode import (AC: 4)
  - [ ] Query param `mode=replace` ou `mode=append`
  - [ ] Replace : supprime toutes les positions avant import
  - [ ] Append : ajoute aux positions existantes
- [ ] Template CSV (AC: 5)
  - [ ] Route `GET /api/portfolio/template`
  - [ ] Retourne fichier CSV vide avec headers
  - [ ] Exemple de ligne en commentaire

## Dev Notes

### Architecture References
- Facilite la migration depuis IBKR ou autre broker
- Export depuis IBKR : Activity Statement > CSV

### CSV Format
```csv
symbol,quantity,avgCost,dateAcquired
AAPL,50,125.00,2024-06-15
MSFT,30,380.50,2024-08-20
GOOGL,10,140.25,
```

### Import Response Format
```typescript
interface ImportResult {
  success: boolean;
  imported: number;
  errors: {
    line: number;
    symbol: string;
    reason: string;
  }[];
  positions: Position[];
}
```

### Dependencies
- Story 2.1 (Portfolio management) doit être complétée
- Story 3.1 (MarketDataService) pour validation symbols

### Testing
_Standards de test à définir dans le document d'architecture_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale (IBKR portfolio) | Sarah (PO) |
| 2026-01-25 | 0.2 | Réécriture : import CSV sans IBKR | Winston (Architect) |
