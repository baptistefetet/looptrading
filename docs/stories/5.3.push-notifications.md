# Story 5.2: Notifications push navigateur

## Status
Done

## Story
**As a** user,
**I want** browser push notifications,
**so that** I get instant alerts when the app is open.

## Acceptance Criteria
1. Service Worker configur√© pour push notifications
2. Permission demand√©e au premier lancement
3. Notification affiche : symbol, strat√©gie, score
4. Clic sur notification ‚Üí page d√©tail de l'action
5. Option enable/disable dans settings

## Tasks / Subtasks
- [x] Configurer Service Worker (AC: 1)
  - [x] Cr√©er `sw.js` pour notifications
  - [x] Enregistrer SW au chargement app
  - [x] Gestion √©v√©nement `push`
  - [x] Gestion √©v√©nement `notificationclick`
- [x] Impl√©menter demande de permission (AC: 2)
  - [x] Modal explicatif au premier lancement
  - [x] Appel `Notification.requestPermission()`
  - [x] Stocker √©tat permission
  - [x] Ne pas re-demander si refus√©
- [x] Cr√©er contenu notification (AC: 3)
  - [x] Titre : "üö® Alerte: SYMBOL"
  - [x] Body : strat√©gie + score
  - [x] Icon : logo app
  - [x] Badge : indicateur visuel
- [x] Impl√©menter navigation au clic (AC: 4)
  - [x] Event `notificationclick`
  - [x] Ouvrir/focus fen√™tre app
  - [x] Naviguer vers `/stocks/:symbol`
  - [x] Fermer notification
- [x] Ajouter toggle dans settings (AC: 5)
  - [x] Champ `pushNotifications` dans UserSettings
  - [x] Toggle UI dans page Settings
  - [x] G√©rer r√©vocation permission navigateur

## Dev Notes
_√Ä compl√©ter apr√®s cr√©ation du document d'architecture_

### Architecture References
- FR4 : Notifications push

### Service Worker Push Handler
```javascript
self.addEventListener('push', event => {
  const data = event.data.json();
  event.waitUntil(
    self.registration.showNotification(data.title, {
      body: data.body,
      icon: '/icon-192.png',
      badge: '/badge-72.png',
      data: { url: data.url }
    })
  );
});

self.addEventListener('notificationclick', event => {
  event.notification.close();
  event.waitUntil(
    clients.openWindow(event.notification.data.url)
  );
});
```

### Polling Integration
- Frontend poll `/api/alerts` toutes les 30s via TanStack Query
- D√©tection de nouvelles alertes par comparaison avec √©tat pr√©c√©dent
- Affichage notification locale quand nouvelle alerte d√©tect√©e

### Dependencies
- Story 5.1 (Alert engine) doit √™tre compl√©t√©e
- Story 1.4 (Frontend shell) doit √™tre compl√©t√©e

### Testing
- Tests unitaires avec Vitest

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Cr√©ation initiale de la story | Sarah (PO) |
| 2026-01-25 | 0.2 | Remplacement WebSocket par polling (arch v3.0) | Winston (Architect) |
