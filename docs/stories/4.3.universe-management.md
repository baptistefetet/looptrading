# Story 4.3: Gestion de l'univers d'actions

## Status
Draft

## Story
**As a** user,
**I want** to define which stocks to monitor,
**so that** I can focus on relevant markets.

## Acceptance Criteria
1. Table `Universe` : symbol, market, sector, active
2. Endpoint `POST /api/universe` pour ajouter des actions
3. Endpoint `DELETE /api/universe/:symbol` pour retirer
4. Import bulk via CSV (symboles S&P 500, CAC 40, etc.)
5. Limite : 500 actions max actives simultanément

## Tasks / Subtasks
- [ ] Créer table Universe (AC: 1)
  - [ ] Migration Prisma
  - [ ] Champs : symbol (PK), name, market, sector, active, createdAt
  - [ ] Index sur market et active
- [ ] Endpoint ajouter action (AC: 2)
  - [ ] Route `POST /api/universe`
  - [ ] Body : symbol, market (optionnel), sector (optionnel)
  - [ ] Validation symbol unique
  - [ ] Auto-fetch nom et secteur via Yahoo Finance
- [ ] Endpoint retirer action (AC: 3)
  - [ ] Route `DELETE /api/universe/:symbol`
  - [ ] Soft delete (active = false) ou hard delete
  - [ ] Cascade sur watchlist si nécessaire
- [ ] Endpoint lister universe (AC: 1)
  - [ ] Route `GET /api/universe`
  - [ ] Filtres : market, active
  - [ ] Pagination
- [ ] Import bulk CSV (AC: 4)
  - [ ] Route `POST /api/universe/import`
  - [ ] Upload fichier CSV
  - [ ] Format : symbol par ligne ou symbol,market,sector
  - [ ] Validation et rapport d'erreurs
  - [ ] Fichiers pré-configurés : S&P 500, CAC 40
- [ ] Implémenter limite 500 actions (AC: 5)
  - [ ] Compter actions actives avant ajout
  - [ ] Erreur 400 si limite atteinte
  - [ ] Message explicite avec count actuel

## Dev Notes
_À compléter après création du document d'architecture_

### Architecture References
- NFR6 : 500 actions max simultanément
- Support marchés US et EU

### CSV Format
```csv
symbol,market,sector
AAPL,US,Technology
MSFT,US,Technology
MC.PA,EU,Luxury
```

### Pre-configured Lists
- S&P 500 : ~500 symboles US
- CAC 40 : 40 symboles .PA
- DAX : 40 symboles .DE

### Dependencies
- Story 1.2 (Database) doit être complétée
- Story 3.1 (MarketDataService) pour auto-fetch infos

### Testing
_Standards de test à définir dans le document d'architecture_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale de la story | Sarah (PO) |
