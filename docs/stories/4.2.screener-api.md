# Story 4.2: API Screener avec filtres

## Status
Draft

## Story
**As a** user,
**I want** to filter stocks by technical criteria,
**so that** I can find stocks matching my strategy.

## Acceptance Criteria
1. Endpoint `GET /api/screener` avec query params :
   - `minScore`, `maxScore`
   - `minRsi`, `maxRsi`
   - `aboveSma50`, `aboveSma200`
   - `minVolume`
   - `market` (US, EU, ALL)
2. Pagination (limit, offset)
3. Tri par score, symbol, ou tout indicateur
4. Réponse < 500ms pour 500 actions
5. Tests d'intégration

## Tasks / Subtasks
- [ ] Créer endpoint screener (AC: 1)
  - [ ] Route `GET /api/screener`
  - [ ] Query params avec validation Zod
  - [ ] Filtres : minScore, maxScore
  - [ ] Filtres : minRsi, maxRsi
  - [ ] Filtres : aboveSma50, aboveSma200 (boolean)
  - [ ] Filtres : minVolume (ratio vs moyenne)
  - [ ] Filtre : market (enum US, EU, ALL)
- [ ] Implémenter pagination (AC: 2)
  - [ ] Query params : limit (default 50, max 100)
  - [ ] Query params : offset (default 0)
  - [ ] Retourner total count dans réponse
  - [ ] Headers pagination (X-Total-Count)
- [ ] Implémenter tri (AC: 3)
  - [ ] Query param : sortBy (score, symbol, rsi, volume, etc.)
  - [ ] Query param : sortOrder (asc, desc)
  - [ ] Default : score desc
- [ ] Optimiser performance (AC: 4)
  - [ ] Index base de données sur colonnes filtrées
  - [ ] Query optimisée Prisma
  - [ ] Benchmark avec 500 actions
  - [ ] Cache si nécessaire
- [ ] Écrire tests d'intégration (AC: 5)
  - [ ] Test filtres individuels
  - [ ] Test combinaison de filtres
  - [ ] Test pagination
  - [ ] Test tri
  - [ ] Test performance

## Dev Notes
_À compléter après création du document d'architecture_

### Architecture References
- FR1 : Filtrer actions selon critères techniques configurables
- NFR6 : 500 actions simultanément

### API Response Format
```json
{
  "data": [
    {
      "symbol": "AAPL",
      "name": "Apple Inc.",
      "price": 150.25,
      "change": 2.5,
      "score": 85,
      "rsi": 55,
      "aboveSma50": true,
      "aboveSma200": true,
      "volume": 1.5
    }
  ],
  "pagination": {
    "total": 234,
    "limit": 50,
    "offset": 0
  }
}
```

### Dependencies
- Story 4.1 (ScoringService) doit être complétée
- Story 3.2-3.3 (Indicateurs) doivent être complétées

### Testing
_Standards de test à définir dans le document d'architecture_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale de la story | Sarah (PO) |
