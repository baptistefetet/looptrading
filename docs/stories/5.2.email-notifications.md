# Story 5.2: Notifications email

## Status
Draft

## Story
**As a** user,
**I want** email notifications for alerts,
**so that** I'm informed even when not using the app.

## Acceptance Criteria
1. Service `NotificationService` avec provider email (Nodemailer/SMTP)
2. Template email HTML avec d√©tails de l'alerte
3. Configuration SMTP via variables d'environnement
4. Option enable/disable par utilisateur
5. Logs des emails envoy√©s

## Tasks / Subtasks
- [ ] Cr√©er NotificationService (AC: 1)
  - [ ] Installer `nodemailer`
  - [ ] Classe service avec injection config
  - [ ] M√©thode `sendEmail(to, subject, html)`
- [ ] Configurer transport SMTP (AC: 1, 3)
  - [ ] Variables env : SMTP_HOST, SMTP_PORT, SMTP_USER, SMTP_PASS
  - [ ] Support TLS
  - [ ] Fallback mode dev (ethereal.email ou console)
- [ ] Cr√©er template email alerte (AC: 2)
  - [ ] Template HTML responsive
  - [ ] Header avec logo/nom app
  - [ ] D√©tails : symbol, strat√©gie, score, prix actuel
  - [ ] Lien vers l'action dans l'app
  - [ ] Style coh√©rent (dark theme)
- [ ] Impl√©menter pr√©f√©rences utilisateur (AC: 4)
  - [ ] Champ `emailNotifications` dans UserSettings
  - [ ] Champ `notificationEmail` pour adresse
  - [ ] V√©rification avant envoi
- [ ] Logger les envois (AC: 5)
  - [ ] Table `NotificationLog` : type, recipient, alertId, sentAt, status
  - [ ] Log succ√®s et √©checs
  - [ ] Metrics : nombre envoy√©s par jour

## Dev Notes
_√Ä compl√©ter apr√®s cr√©ation du document d'architecture_

### Architecture References
- FR4 : Notifications email

### Email Template Structure
```html
<!DOCTYPE html>
<html>
<head><style>/* Dark theme styles */</style></head>
<body style="background: #0d1117; color: #c9d1d9;">
  <h1>üö® Alerte Trading</h1>
  <div class="alert-card">
    <h2>{{symbol}} - {{strategyName}}</h2>
    <p>Score: {{score}}/100</p>
    <p>Prix: {{price}} ({{change}}%)</p>
    <a href="{{appUrl}}/stocks/{{symbol}}">Voir d√©tails</a>
  </div>
</body>
</html>
```

### Environment Variables
```
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
SMTP_FROM="Looptrading <alerts@looptrading.local>"
```

### Dependencies
- Story 5.1 (Alert engine) doit √™tre compl√©t√©e
- Story 1.2 (Database) pour NotificationLog

### Testing
_Standards de test √† d√©finir dans le document d'architecture_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Cr√©ation initiale de la story | Sarah (PO) |
