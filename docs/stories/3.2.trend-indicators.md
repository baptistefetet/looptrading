# Story 3.2: Calcul des indicateurs de tendance

## Status
Draft

## Story
**As a** user,
**I want** trend indicators calculated for stocks,
**so that** I can identify market direction.

## Acceptance Criteria
1. Calcul SMA (20, 50, 200 périodes)
2. Calcul EMA (9, 21 périodes)
3. Endpoint `GET /api/stocks/:symbol/indicators` inclut ces indicateurs
4. Tests unitaires validant les calculs vs valeurs de référence
5. Indicateurs stockés en base pour historique

## Tasks / Subtasks
- [ ] Implémenter calcul SMA (AC: 1)
  - [ ] Fonction `calculateSMA(prices, period)`
  - [ ] SMA 20 jours
  - [ ] SMA 50 jours
  - [ ] SMA 200 jours
- [ ] Implémenter calcul EMA (AC: 2)
  - [ ] Fonction `calculateEMA(prices, period)`
  - [ ] EMA 9 jours
  - [ ] EMA 21 jours
  - [ ] Multiplier = 2 / (period + 1)
- [ ] Créer endpoint indicators (AC: 3)
  - [ ] Route `GET /api/stocks/:symbol/indicators`
  - [ ] Inclure tous les indicateurs
  - [ ] Schema de réponse structuré
- [ ] Écrire tests unitaires (AC: 4)
  - [ ] Valeurs de référence calculées manuellement
  - [ ] Comparaison avec TradingView/autre source
  - [ ] Tests edge cases (données insuffisantes)
- [ ] Persister en base (AC: 5)
  - [ ] Table `StockIndicators`
  - [ ] Colonnes pour chaque indicateur
  - [ ] Timestamp de calcul

## Dev Notes
_À compléter après création du document d'architecture_

### Architecture References
- FR10 : SMA (20, 50, 200), EMA (9, 21)
- Indicateurs pour score composite (FR3)

### Formulas
```
SMA = Σ(prix sur n périodes) / n
EMA = (Prix actuel × k) + (EMA précédent × (1-k))
où k = 2 / (n + 1)
```

### Dependencies
- Story 3.1 (MarketDataService) doit être complétée

### Testing
_Standards de test à définir dans le document d'architecture_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale de la story | Sarah (PO) |
