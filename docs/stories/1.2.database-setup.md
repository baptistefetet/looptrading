# Story 1.2: Configuration base de données et ORM

## Status
Draft

## Story
**As a** developer,
**I want** Prisma configured with SQLite,
**so that** I can persist data locally.

## Acceptance Criteria
1. Prisma installé et configuré à la racine (`prisma/`)
2. Schema initial avec modèles : `Stock`, `StockData`, `Position`, `Alert`, `WatchlistItem`, `AlertRule`, `UserSettings`
3. Migration initiale créée et appliquée
4. Script de seed pour données de test
5. Client Prisma généré et importable dans `src/server/`

## Tasks / Subtasks
- [ ] Installer et configurer Prisma (AC: 1)
  - [ ] Installer `prisma` et `@prisma/client`
  - [ ] Créer `prisma/schema.prisma` avec SQLite provider
  - [ ] Configurer `DATABASE_URL` dans `.env` (`file:./prisma/looptrading.db`)
- [ ] Créer le schema Prisma (AC: 2)
  - [ ] Modèle `Stock` : symbol, name, market, sector, etc.
  - [ ] Modèle `Alert` : symbol, strategy, score, triggeredAt, acknowledged
  - [ ] Modèle `WatchlistItem` : symbol, order, priceTarget, notes
  - [ ] Modèle `UserSettings` : alertPrefs, emailConfig, etc.
  - [ ] Définir les relations entre modèles
- [ ] Créer et appliquer migration (AC: 3)
  - [ ] Générer migration initiale
  - [ ] Appliquer migration en dev
  - [ ] Documenter le processus de migration
- [ ] Créer script de seed (AC: 4)
  - [ ] Données de test pour stocks (10-20 actions)
  - [ ] Données de test pour watchlist
  - [ ] Settings par défaut
- [ ] Configurer client Prisma (AC: 5)
  - [ ] Générer le client
  - [ ] Exporter depuis un module dédié
  - [ ] Configurer logging en dev

## Dev Notes

### Architecture References
- Architecture v3.0 : Schema Prisma complet dans section 9
- ORM : Prisma 5.x
- DB : SQLite uniquement (fichier local)

### Structure cible
```
looptrading/
├── prisma/
│   ├── schema.prisma
│   ├── seed.ts
│   └── looptrading.db (généré)
└── src/server/
    └── lib/
        └── prisma.ts (client export)
```

### Testing
- Tests unitaires avec Vitest
- Base de données de test séparée

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale de la story | Sarah (PO) |
| 2026-01-25 | 0.2 | Mise à jour pour architecture v3.0 | Winston (Architect) |
