# Story 1.2: Configuration base de données et ORM

## Status
Done

## Story
**As a** developer,
**I want** Prisma configured with SQLite,
**so that** I can persist data locally.

## Acceptance Criteria
1. Prisma installé et configuré à la racine (`prisma/`)
2. Schema initial avec modèles : `Stock`, `StockData`, `Position`, `Alert`, `WatchlistItem`, `AlertRule`, `UserSettings`
3. Migration initiale créée et appliquée
4. Script de seed pour données de test
5. Client Prisma généré et importable dans `src/server/`

## Tasks / Subtasks
- [x] Installer et configurer Prisma (AC: 1)
  - [x] Installer `prisma` et `@prisma/client`
  - [x] Créer `prisma/schema.prisma` avec SQLite provider
  - [x] Configurer `DATABASE_URL` dans `.env` (`file:./looptrading.db`)
- [x] Créer le schema Prisma (AC: 2)
  - [x] Modèle `Stock` : symbol, name, market, sector, etc.
  - [x] Modèle `Alert` : symbol, strategy, score, triggeredAt, acknowledged
  - [x] Modèle `WatchlistItem` : symbol, order, priceTarget, notes
  - [x] Modèle `UserSettings` : alertPrefs, emailConfig, etc.
  - [x] Définir les relations entre modèles
- [x] Créer et appliquer migration (AC: 3)
  - [x] Générer migration initiale
  - [x] Appliquer migration en dev
  - [x] Documenter le processus de migration
- [x] Créer script de seed (AC: 4)
  - [x] Données de test pour stocks (15 actions US/EU)
  - [x] Données de test pour watchlist (3 items)
  - [x] Settings par défaut + 4 alert rules
- [x] Configurer client Prisma (AC: 5)
  - [x] Générer le client
  - [x] Exporter depuis un module dédié (`src/server/lib/prisma.ts`)
  - [x] Configurer logging en dev

## Dev Notes

### Architecture References
- Architecture v3.0 : Schema Prisma complet dans section 9
- ORM : Prisma 5.x
- DB : SQLite uniquement (fichier local)

### Structure cible
```
looptrading/
├── prisma/
│   ├── schema.prisma
│   ├── seed.ts
│   └── looptrading.db (généré)
└── src/server/
    └── lib/
        └── prisma.ts (client export)
```

### Testing
- Tests unitaires avec Vitest
- Base de données de test séparée

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale de la story | Sarah (PO) |
| 2026-01-25 | 0.2 | Mise à jour pour architecture v3.0 | Winston (Architect) |
| 2026-01-25 | 1.0 | Implémentation complète | Dev |
