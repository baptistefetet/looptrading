# Story 4.1: Calcul du score composite

## Status
Draft

## Story
**As a** user,
**I want** a composite score for each stock,
**so that** I can quickly identify opportunities.

## Acceptance Criteria
1. Service `ScoringService` implémentant la formule :
   - Tendance LT (25%) : position vs SMA200
   - Tendance MT (20%) : position vs SMA50
   - Momentum (20%) : RSI + MACD
   - Volume (15%) : vs moyenne 20j
   - Sentiment (10%) : basé sur news récentes
   - Proximité support (10%) : distance aux supports
2. Score normalisé 0-100
3. Endpoint `GET /api/stocks/:symbol/score` retourne le détail
4. Tests unitaires avec scénarios variés

## Tasks / Subtasks
- [ ] Créer ScoringService (AC: 1)
  - [ ] Classe service avec injection dépendances
  - [ ] Méthode principale `calculateScore(symbol)`
- [ ] Implémenter composante Tendance LT - 25% (AC: 1)
  - [ ] Position prix vs SMA200
  - [ ] Au-dessus = positif, en-dessous = négatif
  - [ ] Normalisation 0-25
- [ ] Implémenter composante Tendance MT - 20% (AC: 1)
  - [ ] Position prix vs SMA50
  - [ ] Croisements SMA20/SMA50
  - [ ] Normalisation 0-20
- [ ] Implémenter composante Momentum - 20% (AC: 1)
  - [ ] RSI : 30-70 optimal, extrêmes pénalisés
  - [ ] MACD : histogramme positif = bonus
  - [ ] Normalisation 0-20
- [ ] Implémenter composante Volume - 15% (AC: 1)
  - [ ] Ratio volume actuel / moyenne 20j
  - [ ] Volume élevé = confirmation
  - [ ] Normalisation 0-15
- [ ] Implémenter composante Sentiment - 10% (AC: 1)
  - [ ] Analyse news récentes (positif/négatif)
  - [ ] Nombre de news récentes
  - [ ] Normalisation 0-10
- [ ] Implémenter composante Support - 10% (AC: 1)
  - [ ] Identifier supports (plus bas récents)
  - [ ] Distance au support
  - [ ] Normalisation 0-10
- [ ] Normaliser score total (AC: 2)
  - [ ] Somme des composantes = 0-100
  - [ ] Arrondi à l'entier
- [ ] Créer endpoint score (AC: 3)
  - [ ] Route `GET /api/stocks/:symbol/score`
  - [ ] Retourner score total + détail par composante
  - [ ] Schema Zod
- [ ] Écrire tests unitaires (AC: 4)
  - [ ] Scénario haussier fort (score > 80)
  - [ ] Scénario baissier fort (score < 30)
  - [ ] Scénario neutre (score ~50)
  - [ ] Tests edge cases

## Dev Notes
_À compléter après création du document d'architecture_

### Architecture References
- FR3 : Score composite 0-100 avec pondération définie
- Seuil alerte > 75 (FR4)

### Score Formula
```
Score = Tendance_LT × 0.25
      + Tendance_MT × 0.20
      + Momentum × 0.20
      + Volume × 0.15
      + Sentiment × 0.10
      + Proximité_Support × 0.10
```

### Dependencies
- Story 3.2 (SMA/EMA) doit être complétée
- Story 3.3 (RSI/MACD/Volume) doit être complétée
- Story 2.3 (News) pour composante sentiment

### Testing
_Standards de test à définir dans le document d'architecture_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale de la story | Sarah (PO) |
