# Story 1.3: API skeleton avec health-check

## Status
Draft

## Story
**As a** developer,
**I want** a basic Fastify API with health-check endpoint,
**so that** I can verify the backend is operational.

## Acceptance Criteria
1. Fastify configuré avec @fastify/static pour servir React en prod
2. Route `GET /api/health` retourne `{ status: "ok", timestamp: ... }`
3. Validation Zod intégrée
4. Logging structuré configuré (Pino)
5. Variables d'environnement validées au démarrage

## Tasks / Subtasks
- [ ] Configurer Fastify (AC: 1)
  - [ ] Installer Fastify et @fastify/static
  - [ ] Créer `src/server/index.ts` (entry point)
  - [ ] Créer `src/server/app.ts` (Fastify setup)
  - [ ] Configurer static file serving pour production
- [ ] Créer endpoint health-check (AC: 2)
  - [ ] Créer `src/server/routes/health.ts`
  - [ ] Route `GET /api/health`
  - [ ] Retourner status, timestamp, scheduler info
- [ ] Intégrer validation Zod (AC: 3)
  - [ ] Installer Zod
  - [ ] Configurer fastify-type-provider-zod
  - [ ] Créer helpers de validation réutilisables
- [ ] Configurer logging (AC: 4)
  - [ ] Configurer Pino (inclus dans Fastify)
  - [ ] Niveau `debug` en dev, `info` en prod
  - [ ] Format JSON structuré
- [ ] Gérer variables d'environnement (AC: 5)
  - [ ] Créer `src/server/config/env.ts`
  - [ ] Valider avec Zod au démarrage
  - [ ] Variables : DATABASE_URL, PORT, NODE_ENV

## Dev Notes

### Architecture References
- Architecture v3.0 section 11 : Backend Architecture
- Port unique :3000, pas de CORS (même origine)
- Fastify 4.x, Zod 3.x

### Structure cible
```
src/server/
├── index.ts          # Entry point
├── app.ts            # Fastify setup + static serving
├── config/
│   └── env.ts        # Environment validation
└── routes/
    └── health.ts     # Health check endpoint
```

### Testing
- Tests avec Vitest + Supertest pour endpoints

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale de la story | Sarah (PO) |
| 2026-01-25 | 0.2 | Mise à jour pour architecture v3.0 (pas de CORS) | Winston (Architect) |
