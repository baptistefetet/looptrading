# Story 1.3: API skeleton avec health-check

## Status
Done

## Story
**As a** developer,
**I want** a basic Fastify API with health-check endpoint,
**so that** I can verify the backend is operational.

## Acceptance Criteria
1. Fastify configuré avec @fastify/static pour servir React en prod
2. Route `GET /api/health` retourne `{ status: "ok", timestamp: ... }`
3. Validation Zod intégrée
4. Logging structuré configuré (Pino)
5. Variables d'environnement validées au démarrage

## Tasks / Subtasks
- [x] Configurer Fastify (AC: 1)
  - [x] Installer Fastify et @fastify/static
  - [x] Créer `src/server/index.ts` (entry point)
  - [x] Créer `src/server/app.ts` (Fastify setup)
  - [x] Configurer static file serving pour production
- [x] Créer endpoint health-check (AC: 2)
  - [x] Créer `src/server/routes/health.ts`
  - [x] Route `GET /api/health`
  - [x] Retourner status, timestamp, scheduler info
- [x] Intégrer validation Zod (AC: 3)
  - [x] Installer Zod
  - [x] Configurer fastify-type-provider-zod
  - [x] Créer helpers de validation réutilisables
- [x] Configurer logging (AC: 4)
  - [x] Configurer Pino (inclus dans Fastify)
  - [x] Niveau `debug` en dev, `info` en prod
  - [x] Format JSON structuré
- [x] Gérer variables d'environnement (AC: 5)
  - [x] Créer `src/server/config/env.ts`
  - [x] Valider avec Zod au démarrage
  - [x] Variables : DATABASE_URL, PORT, NODE_ENV

## Dev Notes

### Architecture References
- Architecture v3.0 section 11 : Backend Architecture
- Port unique :3000, pas de CORS (même origine)
- Fastify 4.x, Zod 3.x

### Structure cible
```
src/server/
├── index.ts          # Entry point
├── app.ts            # Fastify setup + static serving
├── config/
│   └── env.ts        # Environment validation
└── routes/
    └── health.ts     # Health check endpoint
```

### Testing
- Tests avec Vitest + Supertest pour endpoints

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale de la story | Sarah (PO) |
| 2026-01-25 | 0.2 | Mise à jour pour architecture v3.0 (pas de CORS) | Winston (Architect) |
