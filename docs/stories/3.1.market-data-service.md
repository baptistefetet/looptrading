# Story 3.1: Service de données de marché

## Status
Draft

## Story
**As a** user,
**I want** real-time market data for stocks,
**so that** I can analyze current prices and volumes.

## Acceptance Criteria
1. Service `MarketDataService` créé avec Yahoo Finance
2. Endpoint `GET /api/stocks/:symbol/quote` retourne prix actuel
3. Endpoint `GET /api/stocks/:symbol/history` retourne historique OHLCV
4. Support marchés US et EU (suffixes .PA, .DE, etc.)
5. Rate limiting respecté (Yahoo Finance)
6. Cache des données (TTL 15 minutes)

## Tasks / Subtasks
- [ ] Créer MarketDataService (AC: 1)
  - [ ] Installer `yahoo-finance2` ou équivalent
  - [ ] Créer classe service
  - [ ] Configurer client avec options
- [ ] Endpoint quote temps réel (AC: 2)
  - [ ] Route `GET /api/stocks/:symbol/quote`
  - [ ] Données : price, change, changePercent, volume, high, low
  - [ ] Schema Zod pour réponse
- [ ] Endpoint historique OHLCV (AC: 3)
  - [ ] Route `GET /api/stocks/:symbol/history`
  - [ ] Query params : period (1d, 1w, 1m, 3m, 1y)
  - [ ] Données : date, open, high, low, close, volume
- [ ] Support marchés internationaux (AC: 4)
  - [ ] Mapping symbols EU (.PA pour Paris, .DE pour Francfort)
  - [ ] Détection automatique du marché
  - [ ] Gestion devises
- [ ] Implémenter rate limiting (AC: 5)
  - [ ] Queue de requêtes
  - [ ] Délai entre appels
  - [ ] Retry sur erreur 429
- [ ] Configurer cache (AC: 6)
  - [ ] Cache par symbol
  - [ ] TTL 15 minutes (NFR3)
  - [ ] Invalidation sélective

## Dev Notes
_À compléter après création du document d'architecture_

### Architecture References
- API données : Yahoo Finance (PRD section 4.3)
- NFR3 : Latence données ≤ 15 minutes
- NFR8 : APIs gratuites uniquement

### Testing
_Standards de test à définir dans le document d'architecture_

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 0.1 | Création initiale de la story | Sarah (PO) |
